"use strict";var M=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var L=(t,r)=>{for(var o in r)M(t,o,{get:r[o],enumerable:!0})},_=(t,r,o,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let m of R(r))!k.call(t,m)&&m!==o&&M(t,m,{get:()=>r[m],enumerable:!(i=x(r,m))||i.enumerable});return t};var H=t=>_(M({},"__esModule",{value:!0}),t);var j={};L(j,{default:()=>J});module.exports=H(j);var n=require("@raycast/api"),w=require("react");var p=require("@raycast/api"),O=[{title:"Alarm Clock",icon:p.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:p.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:p.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:p.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:p.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:p.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:p.Icon.Person,value:"speak_timer_name"}];var h=require("@raycast/api"),$=require("child_process"),V=require("crypto"),u=require("fs");var C=t=>{let r=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),i=String(Math.floor(t%60)).padStart(2,"0");return`${r===0?"":r+":"}${o}:${i}`};var a=require("@raycast/api");var E=t=>{let r=(0,a.getPreferenceValues)();if(t.launchedFromMenuBar||r.closeWindowOnTimerStart){let o=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,a.showHUD)(`${o} ${t.msg}`),(0,a.popToRoot)()}else(0,a.showToast)({style:t.isErr?a.Toast.Style.Failure:a.Toast.Style.Success,title:t.msg})};var b=h.environment.supportPath+"/customTimers.json",te=h.environment.supportPath+"/defaultPresetVisibles.json";var I=(t=!1)=>{let r=(0,h.getPreferenceValues)();return parseFloat(r.volumeSetting)>5?(E({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:t,isErr:!0}),!1):!0};async function B({timeInSeconds:t,timerName:r="Untitled",launchedFromMenuBar:o=!1,selectedSound:i="default"}){let c=(h.environment.supportPath+"/"+new Date().toISOString()+"---"+t+".timer").replace(/:/g,"__");(0,u.writeFileSync)(c,r);let d=(0,h.getPreferenceValues)(),S=`${h.environment.assetsPath+"/"+(i==="default"?d.selectedSound:i)}`,f=[`sleep ${t}`];f.push(`if [ -f "${c}" ]; then osascript -e 'display notification "Timer \\"${r}\\" complete" with title "Ding!"'`);let T=`afplay "${S}" --volume ${d.volumeSetting.replace(",",".")}`;if(d.selectedSound==="speak_timer_name"?f.push(`say "${r}"`):f.push(T),d.ringContinuously){let g=`${c}`.replace(".timer",".dismiss");(0,u.writeFileSync)(g,".dismiss file for Timers"),f.push(`while [ -f "${g}" ]; do ${T}; done`)}f.push(`rm "${c}"; else echo "Timer deleted"; fi`),(0,$.exec)(f.join(" ; "),(g,N)=>{if(g){console.log(`error: ${g.message}`);return}if(N){console.log(`stderr: ${N}`);return}}),E({msg:`Timer "${r}" started for ${C(t)}!`,launchedFromMenuBar:o,isErr:!1})}function P(){(0,u.existsSync)(b)||(0,u.writeFileSync)(b,JSON.stringify({}))}function A(t){P();let r=JSON.parse((0,u.readFileSync)(b,"utf8"));r[(0,V.randomUUID)()]=t,(0,u.writeFileSync)(b,JSON.stringify(r))}var l=require("react/jsx-runtime");function J(t){let r=Object.values(t.arguments).some(e=>e!==""),[o,i]=(0,w.useState)(),[m,c]=(0,w.useState)(),[d,S]=(0,w.useState)(),{pop:f}=(0,n.useNavigation)(),T=(0,n.getPreferenceValues)(),g=e=>{if(P(),e.hours===""&&e.minutes===""&&e.seconds==="")new n.Toast({style:n.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(e.hours)))i("Hours must be a number!");else if(isNaN(Number(e.minutes)))c("Minutes must be a number!");else if(isNaN(Number(e.seconds)))S("Seconds must be a number!");else{if(!I())return;f();let s=e.name?e.name:"Untitled",D=3600*Number(e.hours)+60*Number(e.minutes)+Number(e.seconds);B({timeInSeconds:D,timerName:s,selectedSound:e.selectedSound}),e.willBeSaved&&A({name:e.name,timeInSeconds:D,selectedSound:e.selectedSound,showInMenuBar:!0})}},N=()=>{o&&o.length>0&&i(void 0)},F=()=>{m&&m.length>0&&c(void 0)},v=()=>{d&&d.length>0&&S(void 0)},y=[{id:"hours",title:"Hours",placeholder:"0",err:o,drop:N,validator:e=>{let s=e.target.value;isNaN(Number(s))?i("Hours must be a number!"):N()}},{id:"minutes",title:"Minutes",placeholder:"00",err:m,drop:F,validator:e=>{let s=e.target.value;isNaN(Number(s))?c("Minutes must be a number!"):F()}},{id:"seconds",title:"Seconds",placeholder:"00",err:d,drop:v,validator:e=>{let s=e.target.value;isNaN(Number(s))?S("Seconds must be a number!"):v()}}];return T.newTimerInputOrder!=="hhmmss"&&y.reverse(),(0,l.jsxs)(n.Form,{actions:(0,l.jsx)(n.ActionPanel,{children:(0,l.jsx)(n.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:e=>g(e)})}),children:[y.map((e,s)=>(0,l.jsx)(n.Form.TextField,{id:e.id,title:e.title,placeholder:e.placeholder,defaultValue:t.arguments[e.id],error:e.err,onChange:e.drop,onBlur:e.validator},s)),(0,l.jsxs)(n.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,l.jsx)(n.Form.Dropdown.Item,{value:"default",title:"Default"}),O.map((e,s)=>(0,l.jsx)(n.Form.Dropdown.Item,{title:e.value===T.selectedSound?`${e.title} (currently selected)`:e.title,value:e.value,icon:e.icon},s))]}),(0,l.jsx)(n.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:r}),(0,l.jsx)(n.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}
