"use strict";var I=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.prototype.hasOwnProperty;var tt=(t,e)=>{for(var o in e)I(t,o,{get:e[o],enumerable:!0})},et=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of X(e))!Z.call(t,s)&&s!==o&&I(t,s,{get:()=>e[s],enumerable:!(n=Q(e,s))||n.enumerable});return t};var ot=t=>et(I({},"__esModule",{value:!0}),t);var at={};tt(at,{default:()=>K});module.exports=ot(at);var r=require("@raycast/api"),z=require("react");var N=require("@raycast/api"),b=require("react");var S=t=>{let e=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),n=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${o}:${n}`},L=t=>{let e=new Date(t),o=[e.getFullYear().toString(),e.getMonth().toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],n=[e.getHours(),e.getMinutes(),e.getSeconds()].map(T=>T.toString().padStart(2,"0")),s=o.join("-"),f=n.join(":");return`${s} ${f}`},h=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var y=require("@raycast/api"),W=require("child_process"),B=require("crypto"),a=require("fs"),V=require("path");var p=require("@raycast/api");var P=t=>{let e=(0,p.getPreferenceValues)();if(t.launchedFromMenuBar||e.closeWindowOnTimerStart){let o=t.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,p.showHUD)(`${o} ${t.msg}`),(0,p.popToRoot)()}else(0,p.showToast)({style:t.isErr?p.Toast.Style.Failure:p.Toast.Style.Success,title:t.msg})};var c=y.environment.supportPath+"/raycast-stopwatches.json",g=()=>{(!(0,a.existsSync)(c)||(0,a.readFileSync)(c).toString()=="")&&(0,a.writeFileSync)(c,"[]")},v=t=>({name:t,swID:(0,B.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),nt=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,h({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let o=Math.max(0,h({d2:e.timeStarted}));e.timeElapsed=o-e.pauseElapsed}}),t),k=()=>{g();let t=JSON.parse((0,a.readFileSync)(c).toString()),e=rt(t),o=nt(e);return o.sort((n,s)=>n.timeElapsed-s.timeElapsed),o},x=async({swName:t="Untitled",launchedFromMenuBar:e=!1})=>{g();let o=JSON.parse((0,a.readFileSync)(c).toString()),n=v(t);o.push(n),(0,a.writeFileSync)(c,JSON.stringify(o)),P({msg:`Stopwatch "${t}" started!`,launchedFromMenuBar:e,isErr:!1})},U=t=>{g();let e=JSON.parse((0,a.readFileSync)(c).toString());e=e.map(o=>o.swID==t?{...o,lastPaused:new Date}:o),(0,a.writeFileSync)(c,JSON.stringify(e))},_=t=>{g();let e=JSON.parse((0,a.readFileSync)(c).toString());e=e.map(o=>o.swID==t?{...o,pauseElapsed:o.pauseElapsed+h({d2:o.lastPaused}),lastPaused:"----"}:o),(0,a.writeFileSync)(c,JSON.stringify(e))},H=t=>{g();let e=JSON.parse((0,a.readFileSync)(c).toString());e=e.filter(o=>o.swID!==t),(0,a.writeFileSync)(c,JSON.stringify(e))},rt=t=>((0,a.readdirSync)(y.environment.supportPath).forEach(o=>{if((0,V.extname)(o)==".stopwatch"){let n=v((0,a.readFileSync)(y.environment.supportPath+"/"+o).toString()),s=o.replace(/__/g,":").replace(".stopwatch","");n.timeStarted=new Date(s),n.timeElapsed=Math.max(0,h({})),(0,W.execSync)(`rm "${y.environment.supportPath}/${o}"`),t.push(n)}}),(0,a.writeFileSync)(c,JSON.stringify(t)),t),j=(t,e)=>{g();let n=JSON.parse((0,a.readFileSync)(c,"utf8")).map(s=>s.swID==t?{...s,name:e}:s);(0,a.writeFileSync)(c,JSON.stringify(n))};function F(){let[t,e]=(0,b.useState)(void 0),[o,n]=(0,b.useState)(t===void 0),s=()=>{let i=k();e(i),n(!1)},f=i=>{x(i),s()},T=i=>{U(i),s()},C=i=>{_(i),s()},O=i=>{(0,N.getPreferenceValues)().copyOnSwStop&&N.Clipboard.copy(S(i.timeElapsed)),H(i.swID),s()};return{stopwatches:t,isLoading:o,refreshSWes:s,handleRestartSW:i=>{O(i),f({swName:i.name,launchedFromMenuBar:!1}),s()},handleStartSW:f,handleStopSW:O,handlePauseSW:T,handleUnpauseSW:C}}var w=require("@raycast/api");var l=require("@raycast/api");var D=require("@raycast/api");var d=require("fs");var M=D.environment.supportPath+"/customTimers.json",wt=D.environment.supportPath+"/defaultPresetVisibles.json";function G(t,e){let o=D.environment.supportPath+"/"+t;(0,d.writeFileSync)(o,e)}function st(){(0,d.existsSync)(M)||(0,d.writeFileSync)(M,JSON.stringify({}))}function q(t,e){st();let o=JSON.parse((0,d.readFileSync)(M,"utf8"));o[t].name=e,(0,d.writeFileSync)(M,JSON.stringify(o))}var E=require("react/jsx-runtime");function Y(t){let{pop:e}=(0,l.useNavigation)(),o=n=>{if(n===""||n===t.currentName)new l.Toast({style:l.Toast.Style.Failure,title:"No new name given!"}).show();else{switch(e(),t.originalFile){case"customTimer":q(t.ctID?t.ctID:"-99",n);break;case"stopwatch":j(t.ctID?t.ctID:"-99",n);break;default:G(t.originalFile,n);break}P({msg:`Renamed to ${n}!`,launchedFromMenuBar:!1,isErr:!1})}};return(0,E.jsx)(l.Form,{actions:(0,E.jsx)(l.ActionPanel,{children:(0,E.jsx)(l.Action.SubmitForm,{title:"Rename",onSubmit:n=>o(n.newName)})}),children:(0,E.jsx)(l.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var R=require("react/jsx-runtime");function $(t){let{push:e}=(0,w.useNavigation)();return(0,R.jsx)(w.Action,{title:`Rename ${t.renameLabel}`,icon:w.Icon.TextInput,onAction:()=>e((0,R.jsx)(Y,{currentName:t.currentName,originalFile:t.originalFile,ctID:t.ctID}))})}var m=require("react/jsx-runtime");function K(){let{stopwatches:t,isLoading:e,refreshSWes:o,handleRestartSW:n,handleStartSW:s,handleStopSW:f,handlePauseSW:T,handleUnpauseSW:C}=F();(0,z.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]);let O={tag:{value:"Paused",color:r.Color.Red}},J={tag:{value:"Running",color:r.Color.Green}},i={source:r.Icon.Clock,tintColor:r.Color.Red},A={source:r.Icon.Clock,tintColor:r.Color.Green};return(0,m.jsx)(r.List,{isLoading:e,children:(0,m.jsxs)(r.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(u=>(0,m.jsx)(r.List.Item,{icon:u.lastPaused=="----"?A:i,title:u.name,subtitle:S(u.timeElapsed)+" elapsed",accessories:[{text:"Started at "+L(u.timeStarted)},u.lastPaused=="----"?J:O],actions:(0,m.jsxs)(r.ActionPanel,{children:[u.lastPaused=="----"?(0,m.jsx)(r.Action,{title:"Pause Stopwatch",icon:r.Icon.Pause,onAction:()=>T(u.swID)}):(0,m.jsx)(r.Action,{title:"Unpause Stopwatch",icon:r.Icon.Play,onAction:()=>C(u.swID)}),(0,m.jsx)($,{renameLabel:"Stopwatch",currentName:u.name,originalFile:"stopwatch",ctID:u.swID}),(0,m.jsx)(r.Action.CopyToClipboard,{title:"Copy Current Time",shortcut:{modifiers:["cmd"],key:"c"},content:S(u.timeElapsed)}),(0,m.jsx)(r.Action,{title:"Restart Stopwatch",icon:r.Icon.ArrowCounterClockwise,shortcut:{modifiers:["cmd"],key:"r"},onAction:()=>n(u)}),(0,m.jsx)(r.Action,{title:"Stop Stopwatch",icon:r.Icon.Stop,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>f(u)})]})},u.swID)),(0,m.jsx)(r.List.Item,{icon:r.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,m.jsx)(r.ActionPanel,{children:(0,m.jsx)(r.Action,{title:"Start Stopwatch",icon:r.Icon.Stopwatch,onAction:()=>s({})})})},0)]})})}
