"use strict";var G=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var Ce=Object.prototype.hasOwnProperty;var ye=(e,t)=>{for(var n in t)G(e,n,{get:t[n],enumerable:!0})},Pe=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of we(t))!Ce.call(e,s)&&s!==n&&G(e,s,{get:()=>t[s],enumerable:!(r=Te(t,s))||r.enumerable});return e};var Ne=e=>Pe(G({},"__esModule",{value:!0}),e);var Ee={};ye(Ee,{default:()=>ge});module.exports=Ne(Ee);var c=require("@raycast/api"),Se=require("react");var W=require("react");var h=require("@raycast/api"),re=require("child_process"),oe=require("crypto"),a=require("fs"),ie=require("path");var L=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${r}`},te=e=>{let t=new Date(e),n=[t.getFullYear().toString(),t.getMonth().toString().padStart(2,"0"),t.getDate().toString().padStart(2,"0")],r=[t.getHours(),t.getMinutes(),t.getSeconds()].map(i=>i.toString().padStart(2,"0")),s=n.join("-"),u=r.join(":");return`${s} ${u}`},Q=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var w=require("@raycast/api");var V=e=>{let t=(0,w.getPreferenceValues)();if(e.launchedFromMenuBar||t.closeWindowOnTimerStart){let n=e.isErr?"\u26A0\uFE0F":"\u{1F389}";return(0,w.showHUD)(`${n} ${e.msg}`),(0,w.popToRoot)()}else(0,w.showToast)({style:e.isErr?w.Toast.Style.Failure:w.Toast.Style.Success,title:e.msg})};var C=h.environment.supportPath+"/customTimers.json",$e=h.environment.supportPath+"/defaultPresetVisibles.json",ne=e=>{try{(0,a.unlinkSync)(e)}catch(t){if(t instanceof Error&&!t.message.includes("ENOENT"))throw t}},J=(e=!1)=>{let t=(0,h.getPreferenceValues)();return parseFloat(t.volumeSetting)>5?(V({msg:"Timer alert volume should not be louder than 5 (it can get quite loud!)",launchedFromMenuBar:e,isErr:!0}),!1):!0};async function O({timeInSeconds:e,timerName:t="Untitled",launchedFromMenuBar:n=!1,selectedSound:r="default"}){let u=(h.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,a.writeFileSync)(u,t);let i=(0,h.getPreferenceValues)(),f=`${h.environment.assetsPath+"/"+(r==="default"?i.selectedSound:r)}`,N=[`sleep ${e}`];N.push(`if [ -f "${u}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let R=`afplay "${f}" --volume ${i.volumeSetting.replace(",",".")}`;if(i.selectedSound==="speak_timer_name"?N.push(`say "${t}"`):N.push(R),i.ringContinuously){let D=`${u}`.replace(".timer",".dismiss");(0,a.writeFileSync)(D,".dismiss file for Timers"),N.push(`while [ -f "${D}" ]; do ${R}; done`)}N.push(`rm "${u}"; else echo "Timer deleted"; fi`),(0,re.exec)(N.join(" ; "),(D,k)=>{if(D){console.log(`error: ${D.message}`);return}if(k){console.log(`stderr: ${k}`);return}}),V({msg:`Timer "${t}" started for ${L(e)}!`,launchedFromMenuBar:n,isErr:!1})}function se(e){let t=h.environment.supportPath+"/"+e,n=t.replace(".timer",".dismiss");ne(t),ne(n)}function ae(){let e=[];return(0,a.readdirSync)(h.environment.supportPath).forEach(n=>{if((0,ie.extname)(n)==".timer"){let r={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};r.name=(0,a.readFileSync)(h.environment.supportPath+"/"+n).toString();let s=n.split("---");r.secondsSet=Number(s[1].split(".")[0]);let u=s[0].replace(/__/g,":");r.timeLeft=Math.max(0,Math.round(r.secondsSet-Q({d2:u}))),r.timeEnds=new Date(u),r.timeEnds.setSeconds(r.timeEnds.getSeconds()+r.secondsSet),e.push(r)}}),e.sort((n,r)=>n.timeLeft-r.timeLeft),e}function me(e,t){let n=h.environment.supportPath+"/"+e;(0,a.writeFileSync)(n,t)}function b(){(0,a.existsSync)(C)||(0,a.writeFileSync)(C,JSON.stringify({}))}function U(e){b();let t=JSON.parse((0,a.readFileSync)(C,"utf8"));t[(0,oe.randomUUID)()]=e,(0,a.writeFileSync)(C,JSON.stringify(t))}function _(){b();let e=JSON.parse((0,a.readFileSync)(C,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,n])=>n.showInMenuBar===void 0?[t,{...n,showInMenuBar:!0}]:[t,n]))}function ce(e,t){b();let n=JSON.parse((0,a.readFileSync)(C,"utf8"));n[e].name=t,(0,a.writeFileSync)(C,JSON.stringify(n))}function le(e){b();let t=JSON.parse((0,a.readFileSync)(C,"utf8"));delete t[e],(0,a.writeFileSync)(C,JSON.stringify(t))}function ue(e){b();let t=JSON.parse((0,a.readFileSync)(C,"utf8")),n=t[e].showInMenuBar;t[e].showInMenuBar=n===void 0?!1:!n,(0,a.writeFileSync)(C,JSON.stringify(t))}var A=require("@raycast/api");function v(){let[e,t]=(0,W.useState)(void 0),[n,r]=(0,W.useState)({}),[s,u]=(0,W.useState)(e===void 0),i=()=>{b();let m=ae();t(m);let T=_();r(T),u(!1)};return{timers:e,customTimers:n,isLoading:s,refreshTimers:i,handleStartTimer:m=>{J(m.launchedFromMenuBar)&&(O(m),i())},handleStopTimer:m=>{t(e?.filter(T=>T.originalFile!==m.originalFile)),se(m.originalFile),i()},handleStartCT:({customTimer:m,launchedFromMenuBar:T})=>{J(T)&&(O({timeInSeconds:m.timeInSeconds,launchedFromMenuBar:T,timerName:m.name,selectedSound:m.selectedSound}),i())},handleCreateCT:m=>{let T={name:m.name,timeInSeconds:m.secondsSet,selectedSound:"default",showInMenuBar:!0};U(T),i()},handleDeleteCT:async m=>{let T={title:"Delete this preset?",icon:A.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:A.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:A.Alert.ActionStyle.Destructive}};await(0,A.confirmAlert)(T)&&(le(m),i())},handleToggleCTVisibility:async m=>{ue(m),i()}}}var l=require("@raycast/api"),j=require("react");var F=require("@raycast/api"),de=[{title:"Alarm Clock",icon:F.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:F.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:F.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:F.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:F.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:F.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:F.Icon.Person,value:"speak_timer_name"}];var y=require("react/jsx-runtime");function z(e){let t=Object.values(e.arguments).some(o=>o!==""),[n,r]=(0,j.useState)(),[s,u]=(0,j.useState)(),[i,f]=(0,j.useState)(),{pop:N}=(0,l.useNavigation)(),R=(0,l.getPreferenceValues)(),D=o=>{if(b(),o.hours===""&&o.minutes===""&&o.seconds==="")new l.Toast({style:l.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(o.hours)))r("Hours must be a number!");else if(isNaN(Number(o.minutes)))u("Minutes must be a number!");else if(isNaN(Number(o.seconds)))f("Seconds must be a number!");else{if(!J())return;N();let p=o.name?o.name:"Untitled",ee=3600*Number(o.hours)+60*Number(o.minutes)+Number(o.seconds);O({timeInSeconds:ee,timerName:p,selectedSound:o.selectedSound}),o.willBeSaved&&U({name:o.name,timeInSeconds:ee,selectedSound:o.selectedSound,showInMenuBar:!0})}},k=()=>{n&&n.length>0&&r(void 0)},Y=()=>{s&&s.length>0&&u(void 0)},m=()=>{i&&i.length>0&&f(void 0)},q=[{id:"hours",title:"Hours",placeholder:"0",err:n,drop:k,validator:o=>{let p=o.target.value;isNaN(Number(p))?r("Hours must be a number!"):k()}},{id:"minutes",title:"Minutes",placeholder:"00",err:s,drop:Y,validator:o=>{let p=o.target.value;isNaN(Number(p))?u("Minutes must be a number!"):Y()}},{id:"seconds",title:"Seconds",placeholder:"00",err:i,drop:m,validator:o=>{let p=o.target.value;isNaN(Number(p))?f("Seconds must be a number!"):m()}}];return R.newTimerInputOrder!=="hhmmss"&&q.reverse(),(0,y.jsxs)(l.Form,{actions:(0,y.jsx)(l.ActionPanel,{children:(0,y.jsx)(l.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:o=>D(o)})}),children:[q.map((o,p)=>(0,y.jsx)(l.Form.TextField,{id:o.id,title:o.title,placeholder:o.placeholder,defaultValue:e.arguments[o.id],error:o.err,onChange:o.drop,onBlur:o.validator},p)),(0,y.jsxs)(l.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,y.jsx)(l.Form.Dropdown.Item,{value:"default",title:"Default"}),de.map((o,p)=>(0,y.jsx)(l.Form.Dropdown.Item,{title:o.value===R.selectedSound?`${o.title} (currently selected)`:o.title,value:o.value,icon:o.icon},p))]}),(0,y.jsx)(l.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,y.jsx)(l.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var d=require("@raycast/api");var $=require("@raycast/api");var S=require("@raycast/api");var fe=require("@raycast/api");var I=require("fs");var x=fe.environment.supportPath+"/raycast-stopwatches.json",be=()=>{(!(0,I.existsSync)(x)||(0,I.readFileSync)(x).toString()=="")&&(0,I.writeFileSync)(x,"[]")};var pe=(e,t)=>{be();let r=JSON.parse((0,I.readFileSync)(x,"utf8")).map(s=>s.swID==e?{...s,name:t}:s);(0,I.writeFileSync)(x,JSON.stringify(r))};var B=require("react/jsx-runtime");function he(e){let{pop:t}=(0,S.useNavigation)(),n=r=>{if(r===""||r===e.currentName)new S.Toast({style:S.Toast.Style.Failure,title:"No new name given!"}).show();else{switch(t(),e.originalFile){case"customTimer":ce(e.ctID?e.ctID:"-99",r);break;case"stopwatch":pe(e.ctID?e.ctID:"-99",r);break;default:me(e.originalFile,r);break}V({msg:`Renamed to ${r}!`,launchedFromMenuBar:!1,isErr:!1})}};return(0,B.jsx)(S.Form,{actions:(0,B.jsx)(S.ActionPanel,{children:(0,B.jsx)(S.Action.SubmitForm,{title:"Rename",onSubmit:r=>n(r.newName)})}),children:(0,B.jsx)(S.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var K=require("react/jsx-runtime");function H(e){let{push:t}=(0,$.useNavigation)();return(0,K.jsx)($.Action,{title:`Rename ${e.renameLabel}`,icon:$.Icon.TextInput,onAction:()=>t((0,K.jsx)(he,{currentName:e.currentName,originalFile:e.originalFile,ctID:e.ctID}))})}var M=require("react/jsx-runtime"),Ie={tag:{value:"Running",color:d.Color.Yellow}},De={tag:{value:"Finished!",color:d.Color.Green}};function X({timer:e}){let{handleStopTimer:t,handleCreateCT:n}=v();return(0,M.jsx)(d.List.Item,{icon:{source:d.Icon.Clock,tintColor:e.timeLeft===0?d.Color.Green:d.Color.Yellow},title:e.name,subtitle:L(e.timeLeft)+" left",accessories:[{text:L(e.secondsSet)+" originally"},{text:`${e.timeLeft===0?"Ended":"Ends"} at ${te(e.timeEnds)}`},e.timeLeft===0?De:Ie],actions:(0,M.jsxs)(d.ActionPanel,{children:[(0,M.jsx)(d.Action,{title:"Stop Timer",icon:d.Icon.Stop,onAction:()=>t(e)}),(0,M.jsx)(H,{renameLabel:"Timer",currentName:e.name,originalFile:e.originalFile,ctID:null}),(0,M.jsx)(d.Action,{title:"Save Timer as Preset",icon:d.Icon.SaveDocument,shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>n(e)})]})})}var g=require("@raycast/api");var E=require("react/jsx-runtime"),Fe=e=>`raycast://extensions/ThatNerd/timers/manageTimers?context=${encodeURIComponent(JSON.stringify({timerID:e}))}`;function Z(e){let{handleStartCT:t,handleDeleteCT:n}=v();return(0,E.jsx)(g.List.Item,{icon:g.Icon.Clock,title:e.customTimer.name,subtitle:L(e.customTimer.timeInSeconds),actions:(0,E.jsxs)(g.ActionPanel,{children:[(0,E.jsx)(g.Action,{title:"Start Timer",icon:g.Icon.Hourglass,onAction:()=>t({customTimer:e.customTimer})}),(0,E.jsx)(H,{renameLabel:"Timer",currentName:e.customTimer.name,originalFile:"customTimer",ctID:e.id}),(0,E.jsx)(g.Action,{title:"Delete Custom Timer",icon:g.Icon.Trash,shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>n(e.id)}),(0,E.jsx)(g.Action.CreateQuicklink,{quicklink:{name:e.customTimer.name,link:Fe(e.id)},title:"Add Preset to Root Search"})]})})}var P=require("react/jsx-runtime");function ge(e){if(e.launchContext?.timerID){let f=_()[e.launchContext.timerID];if(f==null)(0,c.showToast)({style:c.Toast.Style.Failure,title:"This custom timer no longer exists!"});else{(0,c.popToRoot)(),O({timeInSeconds:f.timeInSeconds,timerName:f.name,selectedSound:f.selectedSound});return}}let{timers:t,customTimers:n,isLoading:r,refreshTimers:s}=v(),{push:u}=(0,c.useNavigation)();return(0,Se.useEffect)(()=>{s(),setInterval(()=>{s()},1e3)},[]),(0,P.jsxs)(c.List,{isLoading:r,children:[(0,P.jsxs)(c.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Timers Running",children:[t?.map(i=>(0,P.jsx)(X,{timer:i},i.originalFile)),(0,P.jsx)(c.List.Item,{icon:c.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,P.jsx)(c.ActionPanel,{children:(0,P.jsx)(c.Action,{title:"Start Timer",icon:c.Icon.Hourglass,onAction:()=>u((0,P.jsx)(z,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,P.jsx)(c.List.Section,{title:"Custom Timers",children:Object.keys(n)?.sort((i,f)=>n[i].timeInSeconds-n[f].timeInSeconds).map(i=>(0,P.jsx)(Z,{customTimer:n[i],id:i},i))})]})}
